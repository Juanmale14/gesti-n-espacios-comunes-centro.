<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Espacios Comunes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #e9ecef;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 1.1rem;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab.active {
            background: white;
            color: #007bff;
            border-bottom: 3px solid #007bff;
        }

        .tab-content {
            display: none;
            padding: 40px;
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        .section-title {
            font-size: 2rem;
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 2px;
        }

        /* Estilos para Pesta√±a 1: Espacios */
        .spaces-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }

        .space-card {
            background: white;
            border: 3px solid #e9ecef;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .space-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .space-card.selected {
            border-color: #28a745;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            transform: translateY(-5px);
        }

        .space-icon {
            font-size: 4rem;
            margin-bottom: 15px;
            display: block;
        }

        .space-name {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
        }

        /* Estilos para Pesta√±a 2: Datos */
        .form-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .teachers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #495057;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .schedule-table th {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }

        .schedule-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #e9ecef;
        }

        .schedule-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .schedule-table select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9rem;
        }

        .time-slot {
            font-weight: 600;
            color: #495057;
            background: #e9ecef !important;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #1e7e34 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40,167,69,0.3);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #117a8b 100%);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(23,162,184,0.3);
        }

        /* Estilos para Pesta√±a 3: Resumen */
        .summary-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #007bff;
        }

        .summary-section {
            margin-bottom: 25px;
        }

        .summary-section h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .summary-content {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .export-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-info {
            background: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }

        .alert-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .spaces-grid {
                grid-template-columns: 1fr;
            }
            
            .teachers-grid {
                grid-template-columns: 1fr;
            }
            
            .export-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .schedule-table {
                font-size: 0.8rem;
            }
        }
    </style>
<style type="text/css">
.grande { font-size: 60px; }
</style>
<script>
// Escribir aqui el c√≥digo Javascript
</script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ Gesti√≥n de Espacios Comunes</h1>
            <p>Sistema integral para la reserva y administraci√≥n de espacios educativos</p>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showTab('espacios')">
                üìç Espacios Comunes
            </button>
            <button class="tab" onclick="showTab('datos')">
                üìù Datos de la Reserva
            </button>
            <button class="tab" onclick="showTab('resumen')">
                üìä Resumen y Exportar
            </button>
        </div>

        <!-- Pesta√±a 1: Espacios Comunes -->
        <div id="espacios" class="tab-content active">
            <h2 class="section-title">Selecci√≥n de Espacios</h2>
            <div class="alert alert-info">
                <strong>Instrucciones:</strong> Selecciona uno o varios espacios comunes haciendo clic en las tarjetas. Los espacios seleccionados se marcar√°n en verde.
            </div>
            <div class="spaces-grid">
                <div class="space-card" onclick="toggleSpace('biblioteca')">
                    <span class="space-icon">üìö</span>
                    <div class="space-name">Biblioteca</div>
                </div>
                <div class="space-card" onclick="toggleSpace('salon-actos')">
                    <span class="space-icon">üé≠</span>
                    <div class="space-name">Sal√≥n de Actos</div>
                </div>
                <div class="space-card" onclick="toggleSpace('aula-informatica')">
                    <span class="space-icon">üíª</span>
                    <div class="space-name">Aula de Inform√°tica</div>
                </div>
                <div class="space-card" onclick="toggleSpace('gimnasio')">
                    <span class="space-icon">üèÉ‚Äç‚ôÇÔ∏è</span>
                    <div class="space-name">Gimnasio</div>
                </div>
            </div>
        </div>

        <!-- Pesta√±a 2: Datos de la Reserva -->
        <div id="datos" class="tab-content">
            <h2 class="section-title">Detalles de la Reserva</h2>
            
            <div class="form-section">
                <h3>üë• Docentes Participantes</h3>
                <div class="teachers-grid">
                    <div class="form-group">
                        <label for="docente1">Docente 1:</label>
                        <input type="text" id="docente1" placeholder="Nombre del docente" onchange="updateScheduleSelects()">
                        <select id="departamento1" style="margin-top: 8px;">
                            <option value="">Selecciona departamento</option>
                            <option value="biologia">Biolog√≠a</option>
                            <option value="economia">Econom√≠a</option>
                            <option value="educacion-fisica">Educaci√≥n F√≠sica</option>
                            <option value="educacion-plastica">Educaci√≥n Pl√°stica y Visual</option>
                            <option value="filosofia">Filosof√≠a</option>
                            <option value="frances">Franc√©s</option>
                            <option value="geografia-historia">Geograf√≠a e Historia</option>
                            <option value="ingles">Ingl√©s</option>
                            <option value="latin">Lat√≠n</option>
                            <option value="lengua">Lengua</option>
                            <option value="matematicas">Matem√°ticas</option>
                            <option value="musica">M√∫sica</option>
                            <option value="religion">Religi√≥n</option>
                            <option value="tecnologia">Tecnolog√≠a</option>
                            <option value="otra">Otra</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="docente2">Docente 2:</label>
                        <input type="text" id="docente2" placeholder="Nombre del docente" onchange="updateScheduleSelects()">
                        <select id="departamento2" style="margin-top: 8px;">
                            <option value="">Selecciona departamento</option>
                            <option value="biologia">Biolog√≠a</option>
                            <option value="economia">Econom√≠a</option>
                            <option value="educacion-fisica">Educaci√≥n F√≠sica</option>
                            <option value="educacion-plastica">Educaci√≥n Pl√°stica y Visual</option>
                            <option value="filosofia">Filosof√≠a</option>
                            <option value="frances">Franc√©s</option>
                            <option value="geografia-historia">Geograf√≠a e Historia</option>
                            <option value="ingles">Ingl√©s</option>
                            <option value="latin">Lat√≠n</option>
                            <option value="lengua">Lengua</option>
                            <option value="matematicas">Matem√°ticas</option>
                            <option value="musica">M√∫sica</option>
                            <option value="religion">Religi√≥n</option>
                            <option value="tecnologia">Tecnolog√≠a</option>
                            <option value="otra">Otra</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="docente3">Docente 3:</label>
                        <input type="text" id="docente3" placeholder="Nombre del docente" onchange="updateScheduleSelects()">
                        <select id="departamento3" style="margin-top: 8px;">
                            <option value="">Selecciona departamento</option>
                            <option value="biologia">Biolog√≠a</option>
                            <option value="economia">Econom√≠a</option>
                            <option value="educacion-fisica">Educaci√≥n F√≠sica</option>
                            <option value="educacion-plastica">Educaci√≥n Pl√°stica y Visual</option>
                            <option value="filosofia">Filosof√≠a</option>
                            <option value="frances">Franc√©s</option>
                            <option value="geografia-historia">Geograf√≠a e Historia</option>
                            <option value="ingles">Ingl√©s</option>
                            <option value="latin">Lat√≠n</option>
                            <option value="lengua">Lengua</option>
                            <option value="matematicas">Matem√°ticas</option>
                            <option value="musica">M√∫sica</option>
                            <option value="religion">Religi√≥n</option>
                            <option value="tecnologia">Tecnolog√≠a</option>
                            <option value="otra">Otra</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="docente4">Docente 4:</label>
                        <input type="text" id="docente4" placeholder="Nombre del docente" onchange="updateScheduleSelects()">
                        <select id="departamento4" style="margin-top: 8px;">
                            <option value="">Selecciona departamento</option>
                            <option value="biologia">Biolog√≠a</option>
                            <option value="economia">Econom√≠a</option>
                            <option value="educacion-fisica">Educaci√≥n F√≠sica</option>
                            <option value="educacion-plastica">Educaci√≥n Pl√°stica y Visual</option>
                            <option value="filosofia">Filosof√≠a</option>
                            <option value="frances">Franc√©s</option>
                            <option value="geografia-historia">Geograf√≠a e Historia</option>
                            <option value="ingles">Ingl√©s</option>
                            <option value="latin">Lat√≠n</option>
                            <option value="lengua">Lengua</option>
                            <option value="matematicas">Matem√°ticas</option>
                            <option value="musica">M√∫sica</option>
                            <option value="religion">Religi√≥n</option>
                            <option value="tecnologia">Tecnolog√≠a</option>
                            <option value="otra">Otra</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="docente5">Docente 5:</label>
                        <input type="text" id="docente5" placeholder="Nombre del docente" onchange="updateScheduleSelects()">
                        <select id="departamento5" style="margin-top: 8px;">
                            <option value="">Selecciona departamento</option>
                            <option value="biologia">Biolog√≠a</option>
                            <option value="economia">Econom√≠a</option>
                            <option value="educacion-fisica">Educaci√≥n F√≠sica</option>
                            <option value="educacion-plastica">Educaci√≥n Pl√°stica y Visual</option>
                            <option value="filosofia">Filosof√≠a</option>
                            <option value="frances">Franc√©s</option>
                            <option value="geografia-historia">Geograf√≠a e Historia</option>
                            <option value="ingles">Ingl√©s</option>
                            <option value="latin">Lat√≠n</option>
                            <option value="lengua">Lengua</option>
                            <option value="matematicas">Matem√°ticas</option>
                            <option value="musica">M√∫sica</option>
                            <option value="religion">Religi√≥n</option>
                            <option value="tecnologia">Tecnolog√≠a</option>
                            <option value="otra">Otra</option>
                        </select>
                    </div>
                </div>
            </div>



            <div class="form-section">
                <h3>üìÖ Fecha de la Reserva</h3>
                <div class="form-group">
                    <label for="fecha-reserva">Selecciona la fecha (semana):</label>
                    <input type="date" id="fecha-reserva" onchange="generateWeeklySchedules()">
                </div>
            </div>

            <div class="form-section">
                <h3>üìö Horario de la Biblioteca</h3>
                <div id="schedule-container-biblioteca">
                    <div class="alert alert-info">
                        <strong>Informaci√≥n:</strong> Selecciona una fecha arriba para generar la tabla de horarios de esta semana.
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üé≠ Horario del Sal√≥n de actos</h3>
                <div id="schedule-container-salon-actos">
                    <div class="alert alert-info">
                        <strong>Informaci√≥n:</strong> Selecciona una fecha arriba para generar la tabla de horarios de esta semana.
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üíª Horario del aula de inform√°tica</h3>
                <div id="schedule-container-aula-informatica">
                    <div class="alert alert-info">
                        <strong>Informaci√≥n:</strong> Selecciona una fecha arriba para generar la tabla de horarios de esta semana.
                    </div>
                </div>
            </div>

            <div class="form-section">
                <h3>üèÉ‚Äç‚ôÇÔ∏è Horario del Gimnasio</h3>
                <div id="schedule-container-gimnasio">
                    <div class="alert alert-info">
                        <strong>Informaci√≥n:</strong> Selecciona una fecha arriba para generar la tabla de horarios de esta semana.
                    </div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="saveConfiguration()">
                    üíæ Guardar Configuraci√≥n
                </button>
            </div>
        </div>

        <!-- Pesta√±a 3: Resumen y Exportar -->
        <div id="resumen" class="tab-content">
            <h2 class="section-title">Resumen y Exportaci√≥n de la Reserva</h2>
            
            <div id="summary-content">
                <div class="alert alert-info">
                    <strong>Informaci√≥n:</strong> Completa los datos en las pesta√±as anteriores y guarda la configuraci√≥n para ver el resumen aqu√≠.
                </div>
            </div>

            <div class="export-buttons">
                <button class="btn btn-success" onclick="exportToPDF()">
                    üìÑ Exportar a PDF
                </button>
                <button class="btn btn-info" onclick="exportToExcel()">
                    üìä Exportar a Excel
                </button>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let selectedSpaces = [];
        let reservationData = {};
        
        // Horarios disponibles
        const timeSlots = [
            'Primera hora', 'Segunda hora', 'Tercera hora', 'Recreo', 
            'Cuarta hora', 'Quinta hora', 'Sexta hora'
        ];
        
        const days = ['lunes', 'martes', 'miercoles', 'jueves', 'viernes'];
        const dayNames = {
            'lunes': 'Lunes',
            'martes': 'Martes',
            'miercoles': 'Mi√©rcoles',
            'jueves': 'Jueves',
            'viernes': 'Viernes'
        };

        // Funci√≥n para cambiar pesta√±as
        function showTab(tabName) {
            // Ocultar todas las pesta√±as
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remover clase active de todos los botones
            const tabButtons = document.querySelectorAll('.tab');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            // Mostrar la pesta√±a seleccionada
            document.getElementById(tabName).classList.add('active');
            
            // Activar el bot√≥n correspondiente
            event.target.classList.add('active');
        }

        // Funci√≥n para seleccionar/deseleccionar espacios
        function toggleSpace(spaceId) {
            const spaceCard = event.target.closest('.space-card');
            
            if (selectedSpaces.includes(spaceId)) {
                // Deseleccionar
                selectedSpaces = selectedSpaces.filter(id => id !== spaceId);
                spaceCard.classList.remove('selected');
            } else {
                // Seleccionar
                selectedSpaces.push(spaceId);
                spaceCard.classList.add('selected');
            }
        }

        // Funci√≥n para generar las tablas de horarios semanales din√°micas
        function generateWeeklySchedules() {
            const selectedDate = document.getElementById('fecha-reserva').value;
            if (!selectedDate) {
                // Restaurar mensajes informativos si no hay fecha
                const spaces = ['biblioteca', 'salon-actos', 'aula-informatica', 'gimnasio'];
                spaces.forEach(space => {
                    const container = document.getElementById(`schedule-container-${space}`);
                    if (container) {
                        container.innerHTML = `
                            <div class="alert alert-info">
                                <strong>Informaci√≥n:</strong> Selecciona una fecha arriba para generar la tabla de horarios de esta semana.
                            </div>
                        `;
                    }
                });
                return;
            }
            
            // Calcular las fechas de la semana
            const date = new Date(selectedDate + 'T00:00:00'); // Evitar problemas de zona horaria
            const dayOfWeek = date.getDay();
            const monday = new Date(date);
            monday.setDate(date.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1));
            
            const weekDates = [];
            for (let i = 0; i < 5; i++) {
                const weekDay = new Date(monday);
                weekDay.setDate(monday.getDate() + i);
                weekDates.push(weekDay);
            }
            
            const spaces = ['biblioteca', 'salon-actos', 'aula-informatica', 'gimnasio'];
            
            spaces.forEach(space => {
                const container = document.getElementById(`schedule-container-${space}`);
                if (container) {
                    // Crear tabla din√°mica
                    let tableHTML = `
                        <table class="schedule-table">
                            <thead>
                                <tr>
                                    <th style="width: 150px;">Horario</th>
                    `;
                    
                    // Cabeceras con fechas
                    weekDates.forEach((weekDate, index) => {
                        const dayName = dayNames[days[index]];
                        const dateStr = weekDate.toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit' });
                        tableHTML += `<th style="width: 140px;">${dayName}<br><small>${dateStr}</small></th>`;
                    });
                    
                    tableHTML += `
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    // Filas de horarios
                    timeSlots.forEach(timeSlot => {
                        const timeSlotId = timeSlot.replace(/\s+/g, '-').toLowerCase().replace(/√±/g, 'n');
                        tableHTML += `<tr>`;
                        tableHTML += `<td class="time-slot">${timeSlot}</td>`;
                        
                        days.forEach(day => {
                            const selectId = `${space}-${day}-${timeSlotId}`;
                            tableHTML += `
                                <td>
                                    <select id="${selectId}" onchange="updateScheduleData()" style="width: 100%; padding: 5px; font-size: 0.9rem;">
                                        <option value="">Sin asignar</option>
                                    </select>
                                </td>
                            `;
                        });
                        
                        tableHTML += `</tr>`;
                    });
                    
                    tableHTML += `
                            </tbody>
                        </table>
                    `;
                    
                    container.innerHTML = tableHTML;
                }
            });
            
            // Actualizar los selects con los profesores disponibles despu√©s de crear las tablas
            setTimeout(() => {
                updateScheduleSelects();
            }, 100);
        }

        // Funci√≥n para actualizar los selects de horario con los docentes
        function updateScheduleSelects() {
            const teachers = [];
            for (let i = 1; i <= 5; i++) {
                const teacherName = document.getElementById(`docente${i}`).value.trim();
                if (teacherName) {
                    teachers.push(teacherName);
                }
            }
            
            const spaces = ['biblioteca', 'salon-actos', 'aula-informatica', 'gimnasio'];
            
            // Actualizar todos los selects existentes
            spaces.forEach(space => {
                timeSlots.forEach(timeSlot => {
                    const timeSlotId = timeSlot.replace(/\s+/g, '-').toLowerCase().replace(/√±/g, 'n');
                    days.forEach(day => {
                        const selectId = `${space}-${day}-${timeSlotId}`;
                        const select = document.getElementById(selectId);
                        if (select) {
                            const currentValue = select.value;
                            select.innerHTML = '<option value="">Sin asignar</option>';
                            
                            teachers.forEach(teacher => {
                                const option = document.createElement('option');
                                option.value = teacher;
                                option.textContent = teacher;
                                if (teacher === currentValue) {
                                    option.selected = true;
                                }
                                select.appendChild(option);
                            });
                        }
                    });
                });
            });
        }
        
        // Funci√≥n para actualizar los datos del horario cuando cambia una selecci√≥n
        function updateScheduleData() {
            // Esta funci√≥n se puede usar para validaciones o actualizaciones en tiempo real
            console.log('Horario actualizado');
        }

        // Funci√≥n para guardar la configuraci√≥n
        function saveConfiguration() {
            // Recopilar datos de espacios
            const spaces = selectedSpaces.map(spaceId => {
                const spaceNames = {
                    'biblioteca': 'Biblioteca',
                    'salon-actos': 'Sal√≥n de Actos',
                    'aula-informatica': 'Aula de Inform√°tica',
                    'gimnasio': 'Gimnasio'
                };
                return spaceNames[spaceId];
            });
            
            // Recopilar datos de docentes con sus departamentos
            const teachers = [];
            for (let i = 1; i <= 5; i++) {
                const teacherName = document.getElementById(`docente${i}`).value.trim();
                const departmentSelect = document.getElementById(`departamento${i}`);
                const departmentValue = departmentSelect.value;
                const departmentText = departmentSelect.selectedOptions[0].textContent;
                
                if (teacherName) {
                    teachers.push({
                        name: teacherName,
                        department: departmentText !== 'Selecciona departamento' ? departmentText : ''
                    });
                }
            }
            
            // Recopilar fecha
            const date = document.getElementById('fecha-reserva').value;
            
            // Recopilar horarios por espacio
            const scheduleBySpace = {};
            const spaceIds = ['biblioteca', 'salon-actos', 'aula-informatica', 'gimnasio'];
            
            spaceIds.forEach(spaceId => {
                scheduleBySpace[spaceId] = {};
                timeSlots.forEach(timeSlot => {
                    scheduleBySpace[spaceId][timeSlot] = {};
                    const timeSlotId = timeSlot.replace(/\s+/g, '-').toLowerCase().replace(/√±/g, 'n');
                    days.forEach(day => {
                        const selectId = `${spaceId}-${day}-${timeSlotId}`;
                        const select = document.getElementById(selectId);
                        if (select && select.value) {
                            scheduleBySpace[spaceId][timeSlot][day] = select.value;
                        }
                    });
                });
            });
            
            // Guardar en objeto global
            reservationData = {
                spaces: spaces,
                teachers: teachers,
                date: date,
                scheduleBySpace: scheduleBySpace
            };
            
            // Mostrar resumen
            displaySummary();
            
            // Mostrar mensaje de √©xito
            alert('‚úÖ Configuraci√≥n guardada correctamente. Puedes ver el resumen en la pesta√±a "Resumen y Exportar".');
        }

        // Funci√≥n para mostrar el resumen
        function displaySummary() {
            const summaryContent = document.getElementById('summary-content');
            
            if (Object.keys(reservationData).length === 0) {
                summaryContent.innerHTML = `
                    <div class="alert alert-info">
                        <strong>Informaci√≥n:</strong> Completa los datos en las pesta√±as anteriores y guarda la configuraci√≥n para ver el resumen aqu√≠.
                    </div>
                `;
                return;
            }
            
            let html = '<div class="summary-card">';
            
            // Espacios seleccionados
            html += `
                <div class="summary-section">
                    <h4>üè¢ Espacios Seleccionados</h4>
                    <div class="summary-content">
                        ${reservationData.spaces.length > 0 ? reservationData.spaces.join(', ') : 'Ning√∫n espacio seleccionado'}
                    </div>
                </div>
            `;
            
            // Docentes
            html += `
                <div class="summary-section">
                    <h4>üë• Docentes Participantes</h4>
                    <div class="summary-content">
            `;
            
            if (reservationData.teachers.length > 0) {
                reservationData.teachers.forEach(teacher => {
                    html += `<strong>${teacher.name}</strong>`;
                    if (teacher.department) {
                        html += ` (${teacher.department})`;
                    }
                    html += '<br>';
                });
            } else {
                html += 'Ning√∫n docente registrado';
            }
            
            html += `
                    </div>
                </div>
            `;
            
            // Fecha
            html += `
                <div class="summary-section">
                    <h4>üìÖ Fecha de Reserva</h4>
                    <div class="summary-content">
                        ${reservationData.date ? new Date(reservationData.date).toLocaleDateString('es-ES') : 'No especificada'}
                    </div>
                </div>
            `;
            
            // Horarios asignados por espacio - Tabla visual
            html += `
                <div class="summary-section">
                    <h4>üïê Horarios Asignados por Espacio</h4>
                    <div class="summary-content">
            `;
            
            // Crear tabla de resumen de horarios
            const spaceNames = {
                'biblioteca': 'üìö Biblioteca',
                'salon-actos': 'üé≠ Sal√≥n de Actos',
                'aula-informatica': 'üíª Aula de Inform√°tica',
                'gimnasio': 'üèÉ‚Äç‚ôÇÔ∏è Gimnasio'
            };
            
            const dayNames = {
                'lunes': 'Lunes',
                'martes': 'Martes',
                'miercoles': 'Mi√©rcoles',
                'jueves': 'Jueves',
                'viernes': 'Viernes'
            };
            
            let hasSchedule = false;
            
            // Verificar si hay horarios asignados
            Object.keys(reservationData.scheduleBySpace || {}).forEach(spaceId => {
                const spaceSchedule = reservationData.scheduleBySpace[spaceId];
                Object.keys(spaceSchedule).forEach(timeSlot => {
                    if (Object.keys(spaceSchedule[timeSlot]).length > 0) {
                        hasSchedule = true;
                    }
                });
            });
            
            if (hasSchedule) {
                html += `
                    <table class="schedule-table" style="margin-top: 15px;">
                        <thead>
                            <tr>
                                <th style="width: 120px;">Horario</th>
                                <th>Lunes</th>
                                <th>Martes</th>
                                <th>Mi√©rcoles</th>
                                <th>Jueves</th>
                                <th>Viernes</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                timeSlots.forEach(timeSlot => {
                    html += `<tr>`;
                    html += `<td class="time-slot" style="font-weight: 600; background: #e9ecef;">${timeSlot}</td>`;
                    
                    days.forEach(day => {
                        html += `<td style="vertical-align: top; padding: 8px;">`;
                        
                        // Buscar asignaciones para este d√≠a y hora
                        let cellContent = '';
                        Object.keys(reservationData.scheduleBySpace || {}).forEach(spaceId => {
                            const spaceSchedule = reservationData.scheduleBySpace[spaceId];
                            if (spaceSchedule[timeSlot] && spaceSchedule[timeSlot][day]) {
                                const teacher = spaceSchedule[timeSlot][day];
                                const spaceName = spaceNames[spaceId].replace(/üìö|üé≠|üíª|üèÉ‚Äç‚ôÇÔ∏è/g, '').trim();
                                cellContent += `
                                    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); 
                                               color: white; padding: 4px 8px; margin: 2px 0; 
                                               border-radius: 6px; font-size: 0.85rem; text-align: center;">
                                        <strong>${spaceName}</strong><br>
                                        <small>${teacher}</small>
                                    </div>
                                `;
                            }
                        });
                        
                        html += cellContent || '<span style="color: #6c757d; font-style: italic;">Libre</span>';
                        html += `</td>`;
                    });
                    
                    html += `</tr>`;
                });
                
                html += `
                        </tbody>
                    </table>
                `;
            } else {
                html += '<p style="text-align: center; color: #6c757d; font-style: italic; padding: 20px;">No hay horarios asignados</p>';
            }
            
            html += `
                    </div>
                </div>
            </div>
            `;
            
            summaryContent.innerHTML = html;
        }

        // Funci√≥n para exportar a PDF
        function exportToPDF() {
            if (Object.keys(reservationData).length === 0) {
                alert('‚ö†Ô∏è Primero debes guardar la configuraci√≥n en la pesta√±a "Datos de la Reserva".');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('landscape'); // Orientaci√≥n horizontal
            
            // Configuraci√≥n de p√°gina
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 15;
            const usableWidth = pageWidth - (margin * 2);
            
            // T√≠tulo
            doc.setFontSize(18);
            doc.setFont(undefined, 'bold');
            doc.text('Gesti√≥n de Espacios Comunes', pageWidth / 2, 20, { align: 'center' });
            doc.setFontSize(14);
            doc.text('Resumen de Reserva', pageWidth / 2, 30, { align: 'center' });
            
            let yPosition = 45;
            
            // Informaci√≥n b√°sica en una sola l√≠nea compacta
            doc.setFontSize(10);
            doc.setFont(undefined, 'normal');
            
            // Espacios y fecha en la misma l√≠nea
            const spacesText = `Espacios: ${reservationData.spaces.join(', ') || 'Ninguno'}`;
            const dateText = reservationData.date ? new Date(reservationData.date + 'T00:00:00').toLocaleDateString('es-ES') : 'No especificada';
            doc.text(spacesText, margin, yPosition);
            doc.text(`Fecha: ${dateText}`, pageWidth - margin - 60, yPosition);
            
            yPosition += 12;
            
            // Docentes en l√≠nea compacta
            if (reservationData.teachers.length > 0) {
                const teachersText = reservationData.teachers.map(t => 
                    t.department ? `${t.name} (${t.department})` : t.name
                ).join(', ');
                doc.text(`Docentes: ${teachersText}`, margin, yPosition);
                yPosition += 12;
            }
            
            yPosition += 8;
            
            // T√≠tulo de la tabla
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text('Tabla de Horarios Asignados', margin, yPosition);
            yPosition += 15;
            
            // Verificar si hay horarios
            let hasSchedule = false;
            Object.keys(reservationData.scheduleBySpace || {}).forEach(spaceId => {
                const spaceSchedule = reservationData.scheduleBySpace[spaceId];
                Object.keys(spaceSchedule).forEach(timeSlot => {
                    if (Object.keys(spaceSchedule[timeSlot]).length > 0) {
                        hasSchedule = true;
                    }
                });
            });
            
            if (hasSchedule) {
                // Configuraci√≥n optimizada de la tabla
                const tableStartX = margin;
                const tableStartY = yPosition;
                const totalTableWidth = usableWidth;
                const horarioColumnWidth = totalTableWidth * 0.18; // 18% para horario
                const dayColumnWidth = (totalTableWidth - horarioColumnWidth) / 5; // Resto dividido entre 5 d√≠as
                const headerHeight = 12;
                const rowHeight = 20; // Altura aumentada para mejor legibilidad
                
                const spaceNames = {
                    'biblioteca': 'Biblioteca',
                    'salon-actos': 'Sal√≥n de Actos',
                    'aula-informatica': 'Aula de Inform√°tica',
                    'gimnasio': 'Gimnasio'
                };
                
                const dayNames = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes'];
                
                // Verificar si la tabla cabe en la p√°gina actual
                const tableHeight = headerHeight + (timeSlots.length * rowHeight);
                if (tableStartY + tableHeight > pageHeight - margin) {
                    doc.addPage();
                    yPosition = margin + 10;
                }
                
                const finalTableStartY = yPosition;
                
                // Dibujar cabecera con colores
                doc.setFillColor(79, 172, 254);
                doc.rect(tableStartX, finalTableStartY, horarioColumnWidth, headerHeight, 'F');
                
                let currentX = tableStartX + horarioColumnWidth;
                for (let i = 0; i < 5; i++) {
                    doc.rect(currentX, finalTableStartY, dayColumnWidth, headerHeight, 'F');
                    currentX += dayColumnWidth;
                }
                
                // Texto de cabecera
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(9);
                doc.setFont(undefined, 'bold');
                doc.text('Horario', tableStartX + 2, finalTableStartY + 8);
                
                currentX = tableStartX + horarioColumnWidth;
                dayNames.forEach((day, index) => {
                    doc.text(day, currentX + 2, finalTableStartY + 8);
                    currentX += dayColumnWidth;
                });
                
                // Dibujar filas de datos
                doc.setTextColor(0, 0, 0);
                let currentY = finalTableStartY + headerHeight;
                
                timeSlots.forEach((timeSlot, rowIndex) => {
                    // Verificar si necesitamos nueva p√°gina
                    if (currentY + rowHeight > pageHeight - margin) {
                        doc.addPage();
                        currentY = margin + 10;
                        
                        // Redibujar cabecera en nueva p√°gina
                        doc.setFillColor(79, 172, 254);
                        doc.rect(tableStartX, currentY - headerHeight, horarioColumnWidth, headerHeight, 'F');
                        
                        let headerX = tableStartX + horarioColumnWidth;
                        for (let i = 0; i < 5; i++) {
                            doc.rect(headerX, currentY - headerHeight, dayColumnWidth, headerHeight, 'F');
                            headerX += dayColumnWidth;
                        }
                        
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(9);
                        doc.setFont(undefined, 'bold');
                        doc.text('Horario', tableStartX + 2, currentY - headerHeight + 8);
                        
                        headerX = tableStartX + horarioColumnWidth;
                        dayNames.forEach((day, index) => {
                            doc.text(day, headerX + 2, currentY - headerHeight + 8);
                            headerX += dayColumnWidth;
                        });
                        
                        doc.setTextColor(0, 0, 0);
                    }
                    
                    // Fondo alternado para filas
                    if (rowIndex % 2 === 0) {
                        doc.setFillColor(248, 249, 250);
                        doc.rect(tableStartX, currentY, totalTableWidth, rowHeight, 'F');
                    }
                    
                    // Bordes de la fila
                    doc.setDrawColor(200, 200, 200);
                    doc.setLineWidth(0.1);
                    doc.rect(tableStartX, currentY, horarioColumnWidth, rowHeight);
                    
                    currentX = tableStartX + horarioColumnWidth;
                    for (let i = 0; i < 5; i++) {
                        doc.rect(currentX, currentY, dayColumnWidth, rowHeight);
                        currentX += dayColumnWidth;
                    }
                    
                    // Texto del horario (columna izquierda)
                    doc.setFontSize(8);
                    doc.setFont(undefined, 'bold');
                    const horarioLines = doc.splitTextToSize(timeSlot, horarioColumnWidth - 4);
                    horarioLines.forEach((line, lineIndex) => {
                        doc.text(line, tableStartX + 2, currentY + 6 + (lineIndex * 4));
                    });
                    
                    // Contenido de cada d√≠a
                    currentX = tableStartX + horarioColumnWidth;
                    days.forEach((day, dayIndex) => {
                        let cellContent = [];
                        Object.keys(reservationData.scheduleBySpace || {}).forEach(spaceId => {
                            const spaceSchedule = reservationData.scheduleBySpace[spaceId];
                            if (spaceSchedule[timeSlot] && spaceSchedule[timeSlot][day]) {
                                const teacher = spaceSchedule[timeSlot][day];
                                const spaceName = spaceNames[spaceId];
                                cellContent.push(`${spaceName}: ${teacher}`);
                            }
                        });
                        
                        doc.setFont(undefined, 'normal');
                        doc.setFontSize(7);
                        
                        if (cellContent.length > 0) {
                            let textY = currentY + 5;
                            cellContent.forEach((content, contentIndex) => {
                                const lines = doc.splitTextToSize(content, dayColumnWidth - 4);
                                lines.forEach((line, lineIndex) => {
                                    if (textY < currentY + rowHeight - 2) { // Verificar que no se salga de la celda
                                        doc.text(line, currentX + 2, textY);
                                        textY += 3;
                                    }
                                });
                                textY += 1; // Espacio entre contenidos
                            });
                        } else {
                            doc.setTextColor(108, 117, 125);
                            doc.text('Libre', currentX + 2, currentY + 10);
                            doc.setTextColor(0, 0, 0);
                        }
                        
                        currentX += dayColumnWidth;
                    });
                    
                    currentY += rowHeight;
                });
                
                // Borde exterior de la tabla
                doc.setDrawColor(79, 172, 254);
                doc.setLineWidth(0.5);
                doc.rect(tableStartX, finalTableStartY, totalTableWidth, currentY - finalTableStartY);
                
            } else {
                doc.setFontSize(12);
                doc.text('No hay horarios asignados', margin, yPosition);
            }
            
            // Pie de p√°gina
            doc.setFontSize(8);
            doc.setTextColor(128, 128, 128);
            doc.text(`Generado el ${new Date().toLocaleDateString('es-ES')} a las ${new Date().toLocaleTimeString('es-ES')}`, 
                     margin, pageHeight - 10);
            
            doc.save('reserva-espacios-comunes.pdf');
            
            // Mostrar mensaje de √©xito
            const successAlert = document.createElement('div');
            successAlert.className = 'alert alert-success';
            successAlert.innerHTML = '<strong>‚úÖ √âxito:</strong> El archivo PDF se ha descargado correctamente con tabla completa y optimizada.';
            document.getElementById('resumen').insertBefore(successAlert, document.querySelector('.export-buttons'));
            
            setTimeout(() => {
                successAlert.remove();
            }, 3000);
        }

        // Funci√≥n para exportar a Excel
        function exportToExcel() {
            if (Object.keys(reservationData).length === 0) {
                alert('‚ö†Ô∏è Primero debes guardar la configuraci√≥n en la pesta√±a "Datos de la Reserva".');
                return;
            }
            
            // Crear libro de trabajo
            const wb = XLSX.utils.book_new();
            
            // Hoja 1: Resumen con tabla visual
            const summaryData = [
                ['GESTI√ìN DE ESPACIOS COMUNES'],
                ['Resumen de Reserva'],
                [''],
                ['Espacios Seleccionados:', reservationData.spaces.join(', ') || 'Ninguno'],
                ['Fecha:', reservationData.date ? new Date(reservationData.date + 'T00:00:00').toLocaleDateString('es-ES') : 'No especificada'],
                [''],
                ['DOCENTES PARTICIPANTES']
            ];
            
            // Agregar docentes con departamentos
            if (reservationData.teachers.length > 0) {
                reservationData.teachers.forEach(teacher => {
                    let teacherText = teacher.name;
                    if (teacher.department) {
                        teacherText += ` (${teacher.department})`;
                    }
                    summaryData.push([teacherText]);
                });
            } else {
                summaryData.push(['Ninguno']);
            }
            
            summaryData.push(['']);
            summaryData.push(['TABLA DE HORARIOS CONSOLIDADA']);
            summaryData.push(['']);
            
            // Crear tabla consolidada de horarios
            const dayNames = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes'];
            const spaceNames = {
                'biblioteca': 'Biblioteca',
                'salon-actos': 'Sal√≥n de Actos',
                'aula-informatica': 'Aula de Inform√°tica',
                'gimnasio': 'Gimnasio'
            };
            
            // Cabecera de la tabla
            summaryData.push(['Horario', ...dayNames]);
            
            // Filas de horarios
            timeSlots.forEach(timeSlot => {
                const row = [timeSlot];
                days.forEach(day => {
                    let cellContent = [];
                    Object.keys(reservationData.scheduleBySpace || {}).forEach(spaceId => {
                        const spaceSchedule = reservationData.scheduleBySpace[spaceId];
                        if (spaceSchedule[timeSlot] && spaceSchedule[timeSlot][day]) {
                            const teacher = spaceSchedule[timeSlot][day];
                            const spaceName = spaceNames[spaceId];
                            cellContent.push(`${spaceName}: ${teacher}`);
                        }
                    });
                    row.push(cellContent.length > 0 ? cellContent.join('\n') : 'Libre');
                });
                summaryData.push(row);
            });
            
            const ws1 = XLSX.utils.aoa_to_sheet(summaryData);
            
            // Aplicar estilos a la hoja de resumen
            const range = XLSX.utils.decode_range(ws1['!ref']);
            
            // Estilo para t√≠tulos
            if (ws1['A1']) {
                ws1['A1'].s = {
                    font: { bold: true, sz: 16 },
                    alignment: { horizontal: 'center' },
                    fill: { fgColor: { rgb: '4FACFE' } }
                };
            }
            
            if (ws1['A2']) {
                ws1['A2'].s = {
                    font: { bold: true, sz: 14 },
                    alignment: { horizontal: 'center' }
                };
            }
            
            // Encontrar la fila de la cabecera de la tabla
            let headerRowIndex = -1;
            for (let i = 0; i < summaryData.length; i++) {
                if (summaryData[i][0] === 'Horario') {
                    headerRowIndex = i + 1; // +1 porque Excel es 1-indexed
                    break;
                }
            }
            
            // Estilo para cabecera de tabla
            if (headerRowIndex > 0) {
                for (let col = 0; col <= 5; col++) {
                    const cellRef = XLSX.utils.encode_cell({ r: headerRowIndex - 1, c: col });
                    if (ws1[cellRef]) {
                        ws1[cellRef].s = {
                            font: { bold: true, color: { rgb: 'FFFFFF' } },
                            fill: { fgColor: { rgb: '4FACFE' } },
                            alignment: { horizontal: 'center' }
                        };
                    }
                }
            }
            
            // Ajustar ancho de columnas
            ws1['!cols'] = [
                { wch: 15 }, // Horario
                { wch: 25 }, // Lunes
                { wch: 25 }, // Martes
                { wch: 25 }, // Mi√©rcoles
                { wch: 25 }, // Jueves
                { wch: 25 }  // Viernes
            ];
            
            XLSX.utils.book_append_sheet(wb, ws1, 'Resumen');
            
            // Hoja 2: Tabla consolidada (solo horarios)
            const consolidatedData = [
                ['TABLA CONSOLIDADA DE HORARIOS'],
                [''],
                ['Horario', ...dayNames]
            ];
            
            timeSlots.forEach(timeSlot => {
                const row = [timeSlot];
                days.forEach(day => {
                    let cellContent = [];
                    Object.keys(reservationData.scheduleBySpace || {}).forEach(spaceId => {
                        const spaceSchedule = reservationData.scheduleBySpace[spaceId];
                        if (spaceSchedule[timeSlot] && spaceSchedule[timeSlot][day]) {
                            const teacher = spaceSchedule[timeSlot][day];
                            const spaceName = spaceNames[spaceId];
                            cellContent.push(`${spaceName}: ${teacher}`);
                        }
                    });
                    row.push(cellContent.length > 0 ? cellContent.join('\n') : 'Libre');
                });
                consolidatedData.push(row);
            });
            
            const ws2 = XLSX.utils.aoa_to_sheet(consolidatedData);
            
            // Estilo para la tabla consolidada
            if (ws2['A1']) {
                ws2['A1'].s = {
                    font: { bold: true, sz: 14 },
                    alignment: { horizontal: 'center' },
                    fill: { fgColor: { rgb: '4FACFE' } }
                };
            }
            
            // Cabecera de tabla
            for (let col = 0; col <= 5; col++) {
                const cellRef = XLSX.utils.encode_cell({ r: 2, c: col });
                if (ws2[cellRef]) {
                    ws2[cellRef].s = {
                        font: { bold: true, color: { rgb: 'FFFFFF' } },
                        fill: { fgColor: { rgb: '4FACFE' } },
                        alignment: { horizontal: 'center' }
                    };
                }
            }
            
            ws2['!cols'] = [
                { wch: 15 }, // Horario
                { wch: 30 }, // Lunes
                { wch: 30 }, // Martes
                { wch: 30 }, // Mi√©rcoles
                { wch: 30 }, // Jueves
                { wch: 30 }  // Viernes
            ];
            
            XLSX.utils.book_append_sheet(wb, ws2, 'Tabla Consolidada');
            
            // Hojas 3-6: Horarios detallados por espacio
            const spaceIds = ['biblioteca', 'salon-actos', 'aula-informatica', 'gimnasio'];
            const spaceSheetNames = {
                'biblioteca': 'Biblioteca',
                'salon-actos': 'Sal√≥n de Actos',
                'aula-informatica': 'Aula de Inform√°tica',
                'gimnasio': 'Gimnasio'
            };
            
            spaceIds.forEach(spaceId => {
                const scheduleData = [
                    [`HORARIO - ${spaceSheetNames[spaceId].toUpperCase()}`],
                    [''],
                    ['Horario', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes']
                ];
                
                timeSlots.forEach(timeSlot => {
                    const row = [timeSlot];
                    days.forEach(day => {
                        const assignment = reservationData.scheduleBySpace[spaceId] && 
                                         reservationData.scheduleBySpace[spaceId][timeSlot] && 
                                         reservationData.scheduleBySpace[spaceId][timeSlot][day];
                        row.push(assignment || 'Libre');
                    });
                    scheduleData.push(row);
                });
                
                const ws = XLSX.utils.aoa_to_sheet(scheduleData);
                
                // Estilo para t√≠tulo del espacio
                if (ws['A1']) {
                    ws['A1'].s = {
                        font: { bold: true, sz: 14 },
                        alignment: { horizontal: 'center' },
                        fill: { fgColor: { rgb: '4FACFE' } }
                    };
                }
                
                // Cabecera de tabla
                for (let col = 0; col <= 5; col++) {
                    const cellRef = XLSX.utils.encode_cell({ r: 2, c: col });
                    if (ws[cellRef]) {
                        ws[cellRef].s = {
                            font: { bold: true, color: { rgb: 'FFFFFF' } },
                            fill: { fgColor: { rgb: '4FACFE' } },
                            alignment: { horizontal: 'center' }
                        };
                    }
                }
                
                ws['!cols'] = [
                    { wch: 15 }, // Horario
                    { wch: 20 }, // Lunes
                    { wch: 20 }, // Martes
                    { wch: 20 }, // Mi√©rcoles
                    { wch: 20 }, // Jueves
                    { wch: 20 }  // Viernes
                ];
                
                XLSX.utils.book_append_sheet(wb, ws, spaceSheetNames[spaceId]);
            });
            
            // Descargar archivo
            XLSX.writeFile(wb, 'reserva-espacios-comunes.xlsx');
            
            // Mostrar mensaje de √©xito
            const successAlert = document.createElement('div');
            successAlert.className = 'alert alert-success';
            successAlert.innerHTML = '<strong>‚úÖ √âxito:</strong> El archivo Excel se ha descargado correctamente con m√∫ltiples hojas y formato mejorado.';
            document.getElementById('resumen').insertBefore(successAlert, document.querySelector('.export-buttons'));
            
            setTimeout(() => {
                successAlert.remove();
            }, 3000);
        }

        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            // La aplicaci√≥n est√° lista, las tablas se generan cuando se selecciona una fecha
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9729679eb2f2ec9f',t:'MTc1NTc3MTY5OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: medium; visibility: hidden;"></iframe>


</body></html>